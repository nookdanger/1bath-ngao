<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <title>ARTs Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>

function previewImage(input, previewId) {
  const file = input.files[0];
  const preview = document.getElementById(previewId);
  if (file && file.type.startsWith("image/")) {
    const reader = new FileReader();
    reader.onload = e => {
      preview.src = e.target.result;
      preview.style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    };
    reader.readAsDataURL(file);
  } else {
    preview.src = "";
    preview.style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ
  }
}
    function showImageInModal(src) {
      const modalImage = document.getElementById("modalImage");
      modalImage.src = src;
      const modal = new bootstrap.Modal(document.getElementById("imageModal"));
      modal.show();
    }

    function handleStatusChange(selectElement, assetId) {
      const selectedValue = selectElement.value;
      const statusText = selectElement.options[selectElement.selectedIndex].text;

      if (selectedValue !== "") {
        document.getElementById("modalAssetId").value = assetId;
        document.getElementById("modalDisposalStatus").value = selectedValue;
        document.getElementById("modalDisposalDescription").value = statusText;

        const modalElement = document.getElementById("statusModal");
        if (modalElement) {
          const modal = new bootstrap.Modal(modalElement);
          modal.show();
        } else {
          console.error("Modal element not found!");
        }
      }
    }



    function enableEdit(assetId) {
      const select = document.getElementById(`select-${assetId}`);
      const fileInput = document.getElementById(`file-${assetId}`);
      const saveBtn = document.getElementById(`saveBtn-${assetId}`);
      const selectStatus = document.getElementById(`select-asset_status-${assetId}`);
      const editbt = document.getElementById(`edit-${assetId}`);

      if (select) select.disabled = false;
      if (selectStatus) selectStatus.disabled = false;
      if (fileInput) fileInput.disabled = false;
      if (saveBtn) saveBtn.classList.remove("d-none");
      if (editbt) editbt.classList.add("d-none");
      toggleDisposalSelect(assetId)
    }


  function toggleDisposalSelect(assetId) {
    const assetSelect = document.getElementById(`select-asset_status-${assetId}`);
    const disposalSelect = document.getElementById(`select-${assetId}`);
    if (assetSelect.value === '2010') {
      disposalSelect.disabled = true;
      disposalSelect.selectedIndex = 0; // reset to default if needed
    } else {
      disposalSelect.disabled = false;
    }
  }




  </script>
  <script>
    function goToAssetPage(disposalStatus) {
      const costCenter = document.getElementById('cost_center')?.value || '';
      window.location.href = `/assets?disposal_status=${disposalStatus}&cost_center=${costCenter}`;
    }

   

  </script>
  <style>
    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: "Segoe UI", sans-serif;
      background-color: #f4f6f8;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    .container {
      display: flex;
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .sidebar {
      width: 220px;
      background-color: #1976d2;
      color: white;
      padding: 20px;
      overflow-y: auto;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
    }

    .content {
      margin-left: 220px;
      padding: 30px;
      flex-grow: 1;
      width: calc(100vw - 220px);
      /* ‡πÄ‡∏û‡∏¥‡πà‡∏° width ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏° */
      overflow-x: auto;
      overflow-y: auto;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .sidebar h2 {
      font-size: 20px;
      margin-bottom: 20px;
    }

    .sidebar a {
      display: block;
      color: white;
      padding: 10px;
      text-decoration: none;
      border-radius: 6px;
      transition: background 0.2s;
    }

    .sidebar a:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .header {
      font-size: 24px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
      border-radius: 6px;
      overflow: hidden;
    }

    th,
    td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }

    th {
      background-color: #f1f1f1;
      font-weight: bold;
    }

    tr:hover {
      background-color: #f9f9f9;
    }

    td:first-child {
      cursor: pointer;
      color: #1976d2;
    }

    canvas {
      max-width: 100% !important;
      max-height: 300px !important;
    }
  </style>
</head>

<body>
  <div class="">
    <div class="sidebar">
      <h2>‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏á‡∏≤‡∏ß</h2>
        <a href="/main">üìä Dashboard</a>
        <a href="/process">‚ôªÔ∏è ‡∏ú‡∏±‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</a>
        <a href="/download">üìù ‡∏î‡∏≤‡∏ß‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</a>
        <a href="/report">üìÑ Report</a>
        <a href="/other">üìÑ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ</a>

      <a
        href="/main?disposal_status={{ request.query_params.get('disposal_status') }}&cost_center={{request.query_params.get('cost_center')}}&asset_status={{request.query_params.get('asset_status')}}">‚¨ÖÔ∏è
        ‡∏Å‡∏•‡∏±‡∏ö</a>
    </div>

    <div class="content">
        <div class="header">
          <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô:</label>
          <select id="cost_center" name="cost_center"  value="{{ request.query_params.get('cost_center') }}" disabled>
            <option value="" >-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
            <option value="A303701000" {{ 'selected' if request.query_params.get('cost_center')=='A303701000' else ''
              }}>‡πÅ‡∏ú‡∏ô‡∏Å‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</option>
            <option value="A303701010" {{ 'selected' if request.query_params.get('cost_center')=='A303701010' else ''
              }}>‡πÅ‡∏ú‡∏ô‡∏Å‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</option>
            <option value="A303701020" {{ 'selected' if request.query_params.get('cost_center')=='A303701020' else ''
              }}>‡πÅ‡∏ú‡∏ô‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</option>
            <option value="A303701030" {{ 'selected' if request.query_params.get('cost_center')=='A303701030' else ''
              }}>‡πÅ‡∏ú‡∏ô‡∏Å‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô</option>
            <option value="A303701040" {{ 'selected' if request.query_params.get('cost_center')=='A303701040' else ''
              }}>‡πÅ‡∏ú‡∏ô‡∏Å‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏´‡∏°‡πâ‡∏≠‡πÅ‡∏õ‡∏•‡∏á</option>
          </select>
        </div>
        <form method="get" action="/asset" class="mb-3" >
          <input type="hidden"  name="cost_center" value="{{ request.query_params.get('cost_center') }}">
       
        <div class="input-group">
          <label class="input-group-text">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå:</label>
          <select class="form-select" name="asset_status"  onchange="this.form.submit()">
            <option value="">-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
            <option value="2010" {{ 'selected' if request.query_params.get('asset_status')=='2010' else '' }}>
              ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á/‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
            <option value="2020" {{ 'selected' if request.query_params.get('asset_status')=='2020' else '' }}>
              ‡∏ä‡∏≥‡∏£‡∏∏‡∏î</option>
            <option value="2030" {{ 'selected' if request.query_params.get('asset_status')=='2030' else '' }}>
              ‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
            <option value="2040" {{ 'selected' if request.query_params.get('asset_status')=='2040' else '' }}>
              ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</option>
            <option value="2050" {{ 'selected' if request.query_params.get('asset_status')=='2050' else '' }}>
              ‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢</option>
            <option value="2060" {{ 'selected' if request.query_params.get('asset_status')=='2060' else '' }}>
              ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πà‡∏≤</option>
            <option value="3010" {{ 'selected' if request.query_params.get('asset_status')=='3010' else '' }}>
              ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢(‡∏Ç‡∏≤‡∏¢)</option>
            <option value="3020" {{ 'selected' if request.query_params.get('asset_status')=='3020' else '' }}>
              ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢(‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</option>
            <option value="3030" {{ 'selected' if request.query_params.get('asset_status')=='3030' else '' }}>
              ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢(‡πÇ‡∏≠‡∏ô)</option>
                <option value="3040" {{ 'selected' if request.query_params.get('asset_status')=='3040' else '' }}>
              ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢(‡πÅ‡∏õ‡∏£‡∏™‡∏†‡∏≤‡∏û)</option>
                <option value="3050" {{ 'selected' if request.query_params.get('asset_status')=='3050' else '' }}>
              ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢(‡∏ó‡∏≥‡∏•‡∏≤‡∏¢)</option>
                <option value="4010" {{ 'selected' if request.query_params.get('asset_status')=='4010' else '' }}>
              ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏π‡∏ç</option>
              <option value="4020" {{ 'selected' if request.query_params.get('asset_status')=='4020' else '' }}>
              ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤</option>
          </select>
        </div>
         <div class="input-group">
          <label class="input-group-text">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</label>
          <select class="form-select" name="disposal_status" onchange="this.form.submit()">
            <option value="">---‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î---</option>
            <option value="1" {{ 'selected' if request.query_params.get('disposal_status')=='1' else '' }}>
              1.‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</option>
            <option value="2" {{ 'selected' if request.query_params.get('disposal_status')=='2' else '' }}>
              2.‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏≠‡∏ö</option>
            <option value="3" {{ 'selected' if request.query_params.get('disposal_status')=='3' else '' }}>
              3.‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á</option>
            <option value="4" {{ 'selected' if request.query_params.get('disposal_status')=='4' else '' }}>
              4.‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
            <option value="5" {{ 'selected' if request.query_params.get('disposal_status')=='5' else '' }}>
              5.‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</option>
            <option value="6" {{ 'selected' if request.query_params.get('disposal_status')=='6' else '' }}>
              6.‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢/‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</option>
            <option value="7" {{ 'selected' if request.query_params.get('disposal_status')=='7' else '' }}>
              7.‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á/‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à</option>
            <option value="8" {{ 'selected' if request.query_params.get('disposal_status')=='8' else '' }}>
              8.‡∏ï‡∏±‡∏î‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö/‡πÇ‡∏≠‡∏ô</option>
            <option value="9" {{ 'selected' if request.query_params.get('disposal_status')=='9' else '' }}>
              9.‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</option>
          </select>
        </div>
      </form>
      <table class="table table-bordered table-striped mt-3 align-middle">
        <thead class="table-dark">
          <tr>
            <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
            <th>‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</th>
            <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏¢‡πà‡∏≠‡∏¢</th>
            <th>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</th>
            <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏∏‡∏ô</th>
            <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏°‡∏≤</th>

            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
            <th>‡∏£‡∏π‡∏õ</th>
            <th>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</th>
          </tr>
        </thead>
        <tbody>
          {% for asset in assets %}
          <form method="post" action="/update-status" enctype="multipart/form-data" onsubmit="return validateStatus('{{ asset['id'] }}')">
            <input type="hidden" value="{{ request.query_params.get('cost_center') }}" name="cost_center">
            <input type="hidden" value="{{ request.query_params.get('disposal_status')}}"
              name="disposal_status_selected">
             <input type="hidden" value="{{ request.query_params.get('asset_status')}}"
              name="asset_status_selected">
            <tr>
              <td onclick="window.location='/asset/{{ asset['id'] }}?cost_center={{ request.query_params.get('cost_center') }}&disposal_status={{ request.query_params.get('disposal_status')}}&asset_status={{ request.query_params.get('asset_status')}}'" style="cursor: pointer;">{{ loop.index }}</td>
              <td>{{ asset["asset_id"] }}</td>
              <td>{{ asset["sub_number"] }}</td>
              <td>{{ asset["description"] }}</td>
               <td>{{ asset["product_code"] if asset["product_code"] else '' }}</td>
            <td>{{ asset["capitalized_date"][:10] if asset["capitalized_date"] else '' }}</td>
            
             <td> {{ "{:,.2f}".format(asset["acquisition_value"] or 0) }}</td>
              <td>
                <select name="asset_status" disabled class="form-select form-select-sm"
                  id="select-asset_status-{{ asset['id'] }}" onchange="toggleDisposalSelect('{{ asset['id'] }}')">
                  <option value="" disabled {% if asset["asset_status"]== None %}selected{% endif %}>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                  <option value="2010" {% if asset["asset_status"]=='2010' %}selected{% endif %}>2010: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á/‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option> 
                  <option value="2020" {% if asset["asset_status"]=='2020' %}selected{% endif %}>2020: ‡∏ä‡∏≥‡∏£‡∏∏‡∏î</option> 
                  <option value="2030" {% if asset["asset_status"]=='2030' %}selected{% endif %}>2030: ‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option> 
                  <option value="2040" {% if asset["asset_status"]=='2040' %}selected{% endif %}>2040: ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</option> 
                  <option value="2050" {% if asset["asset_status"]=='2050' %}selected{% endif %}>2050: ‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢</option> 
                  <option value="2060" {% if asset["asset_status"]=='2060' %}selected{% endif %}>2060: ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πà‡∏≤</option> 
                  <option value="3010" {% if asset["asset_status"]=='3010' %}selected{% endif %}>3010: ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢(‡∏Ç‡∏≤‡∏¢)</option> 
                  <option value="3020" {% if asset["asset_status"]=='3020' %}selected{% endif %}>3020: ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢(‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</option> 
                  <option value="3030" {% if asset["asset_status"]=='3030' %}selected{% endif %}>3030: ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢(‡πÇ‡∏≠‡∏ô)</option> 
                  <option value="3040" {% if asset["asset_status"]=='3040' %}selected{% endif %}>3040: ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢(‡πÅ‡∏õ‡∏£‡∏™‡∏†‡∏≤‡∏û)</option> 
                  <option value="3050" {% if asset["asset_status"]=='3050' %}selected{% endif %}>3050: ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢(‡∏ó‡∏≥‡∏•‡∏≤‡∏¢)</option> 
                  <option value="4010" {% if asset["asset_status"]=='4010' %}selected{% endif %}>4010: ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏π‡∏ç</option> 
                  <option value="4020" {% if asset["asset_status"]=='4020' %}selected{% endif %}>4020: ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤</option> 
              </td>
              <td>
                {% set current_status = asset["disposal_status"] | int %}
                <select name="disposal_status" class="form-select form-select-sm" id="select-{{ asset['id'] }}" disabled
                  onchange="handleStatusChange(this, '{{ asset['id'] }}')">

                  {% for value, label in [
                    ('', '--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å--'),
                    ('1', '1: ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢/‡πÇ‡∏≠‡∏ô'),
                    ('2', '2: ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏≠‡∏ö'),
                    ('3', '3: ‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á'),
                    ('4', '4: ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö'),
                    ('5', '5: ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢'),
                    ('6', '6: ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢/‡∏£‡∏≠‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö'),
                    ('7', '7: ‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á/‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à'),
                    ('8', '8: ‡∏ï‡∏±‡∏î‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢/‡πÇ‡∏≠‡∏ô ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö SAP'),
                    ('9', '9: ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢/‡πÇ‡∏≠‡∏ô')
                  ] %}
                    {% set step = value | int %}
                    <option value="{{ value }}"
                      {% if asset["disposal_status"] == value %}selected{% endif %}
                      {% if step != current_status and step != current_status + 1 %}disabled{% endif %}>
                      {{ label }}
                    </option>
                  {% endfor %}
                </select>
              </td>
              <td>
<!-- ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ) -->
<img id="preview-{{ asset['id'] }}"
  src="{% if asset['image'] %}data:image/png;base64,{{ asset['image'] }}{% else %}#{% endif %}"
  alt="Preview"
  class="border mt-1 img-thumbnail"
  style="max-height: 100px; cursor: pointer; {% if not asset['image'] %}display: none;{% endif %}"
  onclick="showImageInModal(this.src)">


                {% if asset["image"] %}
                <div class="text-center mt-1">
                  <a href="/delete-image/{{ asset['id'] }}?cost_center={{request.query_params.get('cost_center')}}&disposal_status={{request.query_params.get('disposal_status')}}&asset_status={{request.query_params.get('asset_status')}}" class="btn btn-sm btn-outline-danger">üóëÔ∏è ‡∏•‡∏ö‡∏£‡∏π‡∏õ</a>
                </div>
                {% else %}
                <label class="btn btn-outline-secondary btn-sm w-100">
                  üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ
                  <input type="file" name="image_file" accept="image/*" hidden id="file-{{ asset['id'] }}"
                    onchange="previewImage(this, 'preview-{{ asset['id'] }}')" disabled capture="environment">

                </label>
                {% endif %}
              </td>
              <td>
                <input type="hidden" name="id" value="{{ asset['id'] }}">
                <div class="d-flex gap-1">

                  <button type="button" class="btn btn-warning btn-sm" id="edit-{{ asset['id'] }}" onclick="enableEdit('{{ asset['id'] }}')">‚úèÔ∏è
                    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>

                  <button type="submit" class="btn btn-success btn-sm d-none" id="saveBtn-{{ asset['id'] }}" >üíæ
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>


              </td>
            </tr>
          </form>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</body>
<!-- Modal viewer -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-transparent border-0 shadow-none">
      <div class="modal-body text-center">
        <img id="modalImage" src="" class="img-fluid rounded" style="max-height: 80vh;">
      </div>
    </div>
  </div>
</div>

<!-- Modal for log-status -->
<div class="modal fade" id="statusModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form id="logStatusForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="asset_id" id="modalAssetId">
        <input type="hidden" name="status_code" id="modalDisposalStatus">
        <input type="hidden" name="status_description" id="modalDisposalDescription">
        <div class="mb-3">
          <label class="form-label">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ / ref ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£:</label>
          <input type="text" name="ref_document" class="form-control" required id="modalRefDocument">

        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>
  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll("select, button, input").forEach(el => {
      el.addEventListener("click", e => e.stopPropagation());
    });
  });
  document.getElementById("logStatusForm").addEventListener("submit", async function (event) {
    event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ reload ‡∏´‡∏ô‡πâ‡∏≤

    const assetId = document.getElementById("modalAssetId").value;
    const statusCode = document.getElementById("modalDisposalStatus").value;
    const statusDescription = document.getElementById("modalDisposalDescription").value;
    const refDocument = document.getElementById("modalRefDocument").value;

    const formData = new FormData();
    formData.append("asset_id", assetId);
    formData.append("status_code", statusCode);
    formData.append("status_description", statusDescription);
    formData.append("ref_document", refDocument);

    const response = await fetch("/log-status", {
      method: "POST",
      body: formData,
    });

    const result = await response.json();

    if (result.message === "OK") {
      const modalElement = bootstrap.Modal.getInstance(document.getElementById("statusModal"));
      modalElement.hide();

      // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤
      document.getElementById("modalRefDocument").value = "";

    }

  });

  function validateStatus(assetId) {

    const assetStatus = document.getElementById(`select-asset_status-${assetId}`)?.value;
    const disposalStatus = document.getElementById(`select-${assetId}`)?.value;
    // ‡∏ñ‡πâ‡∏≤ asset_status ‚â† 2010 ‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å disposal_status
    if (assetStatus !== "2010" && (!disposalStatus || disposalStatus === "")) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏´‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà '‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á/‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'");
      document.getElementById(`select-${assetId}`).focus()
      return false; // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å submit
    }

    // ‡πÄ‡∏õ‡∏¥‡∏î select disposal_status ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å disable ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô submit
    document.getElementById(`select-${assetId}`).disabled = false;
    return true; // ‡πÉ‡∏´‡πâ submit ‡πÑ‡∏î‡πâ
  }

</script>

</html>
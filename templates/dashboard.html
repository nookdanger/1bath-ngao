<!-- templates/dashboard.html -->
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Dashboard ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô 1 ‡∏ö‡∏≤‡∏ó</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script>
    function previewImage(input, previewId) {
      const file = input.files[0];
      const preview = document.getElementById(previewId);
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = e => preview.src = e.target.result;
        reader.readAsDataURL(file);
      } else {
        preview.src = "";
      }
    }

    function showImageInModal(src) {
      const modalImage = document.getElementById("modalImage");
      modalImage.src = src;
      const modal = new bootstrap.Modal(document.getElementById("imageModal"));
      modal.show();
    }
  </script>
</head>
<body class="container py-4">
  <h2>üìä Dashboard ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ 1 ‡∏ö‡∏≤‡∏ó</h2>
  <form method="get" action="/dashboard" class="mb-3">
    <div class="input-group">
      <label class="input-group-text">‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
      <select class="form-select" name="status" onchange="this.form.submit()">
        <option value="">-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
        <option value="1" {{ 'selected' if request.query_params.get('status') == '1' else '' }}>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</option>
        <option value="2" {{ 'selected' if request.query_params.get('status') == '2' else '' }}>‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ä‡∏≥‡∏£‡∏∏‡∏î</option>
        <option value="3" {{ 'selected' if request.query_params.get('status') == '3' else '' }}>‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏≠‡∏ö</option>
        <option value="4" {{ 'selected' if request.query_params.get('status') == '4' else '' }}>‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á</option>
        <option value="5" {{ 'selected' if request.query_params.get('status') == '5' else '' }}>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
        <option value="6" {{ 'selected' if request.query_params.get('status') == '6' else '' }}>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</option>
      </select>
    </div>
  </form>
  <table class="table table-bordered table-striped mt-3 align-middle">
    <thead class="table-dark">
      <tr>
        <th>id</th>
        <th>‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</th>
        <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡∏Ñ‡∏•‡∏±‡∏á</th>
        <th>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</th>
        <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏£‡∏π‡∏õ</th>
        <th>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</th>
      </tr>
    </thead>
    <tbody>
      {% for asset in assets %}
      <form method="post" action="/update-status" enctype="multipart/form-data">
        <tr>
          <td>{{ asset["id"] }}</td>
          <td>{{ asset["asset_id"] }}</td>
          <td>{{ asset["inventory_code"] }}</td>
          <td>{{ asset["description"] }}</td>
          <td>{{ "{:,.2f}".format(asset["acquisition_value"] or 0) }}</td>
          <td>
            <select name="disposal_status" class="form-select form-select-sm">
              <option value="1" {% if asset["disposal_status"] == '1' %}selected{% endif %}>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</option>
              <option value="2" {% if asset["disposal_status"] == '2' %}selected{% endif %}>‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ä‡∏≥‡∏£‡∏∏‡∏î</option>
              <option value="3" {% if asset["disposal_status"] == '3' %}selected{% endif %}>‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏≠‡∏ö</option>
              <option value="4" {% if asset["disposal_status"] == '4' %}selected{% endif %}>‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á</option>
              <option value="5" {% if asset["disposal_status"] == '5' %}selected{% endif %}>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
              <option value="6" {% if asset["disposal_status"] == '6' %}selected{% endif %}>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</option>
            </select>
          </td>
          <td>
            <img id="preview-{{ asset['id'] }}"
            src="data:image/png;base64,{{ asset['image'] if asset['image'] else '' }}"
            alt="Preview"
            class="border mt-1 img-thumbnail"
            style="max-height: 100px; cursor: pointer; "
            onclick="showImageInModal(this.src)">

              
              {% if asset["image"] %}
            <div class="text-center mt-1">
                <a href="/delete-image/{{ asset['id'] }}" class="btn btn-sm btn-outline-danger">üóëÔ∏è ‡∏•‡∏ö‡∏£‡∏π‡∏õ</a>
            </div>
            {% else %}
            <label class="btn btn-outline-secondary btn-sm w-100">
                üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ
                <input type="file" name="image_file" accept="image/*" hidden
                       onchange="previewImage(this, 'preview-{{ asset['id'] }}')">
              </label>
            {% endif %}
          </td>
          <td>
            <input type="hidden" name="id" value="{{ asset['id'] }}">
            <button class="btn btn-success btn-sm">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </td>
        </tr>
      </form>
      {% endfor %}
    </tbody>
  </table>

  <!-- Modal viewer -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-transparent border-0 shadow-none">
        <div class="modal-body text-center">
          <img id="modalImage" src="" class="img-fluid rounded" style="max-height: 80vh;">
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
